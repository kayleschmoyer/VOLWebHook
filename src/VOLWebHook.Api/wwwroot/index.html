<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>VOLWebHook - Enterprise Webhook Capture</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <style>
        :root {
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-card: #1e293b;
            --bg-card-hover: #334155;
            --text-primary: #f8fafc;
            --text-secondary: #94a3b8;
            --text-muted: #64748b;
            --accent: #3b82f6;
            --accent-hover: #2563eb;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --border: #334155;
            --gradient-1: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-2: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --gradient-3: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --gradient-4: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
        }

        .light-mode {
            --bg-primary: #f8fafc;
            --bg-secondary: #ffffff;
            --bg-card: #ffffff;
            --bg-card-hover: #f1f5f9;
            --text-primary: #0f172a;
            --text-secondary: #475569;
            --text-muted: #94a3b8;
            --border: #e2e8f0;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            min-height: 100vh;
            transition: background 0.3s, color 0.3s;
        }

        /* Animated background */
        .bg-pattern {
            position: fixed;
            inset: 0;
            background:
                radial-gradient(circle at 20% 80%, rgba(59, 130, 246, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(139, 92, 246, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(16, 185, 129, 0.05) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
            position: relative;
            z-index: 1;
        }

        /* Header */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid var(--border);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo-icon {
            width: 48px;
            height: 48px;
            background: var(--gradient-1);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            box-shadow: 0 4px 20px rgba(59, 130, 246, 0.3);
        }

        .logo h1 {
            font-size: 1.75rem;
            font-weight: 800;
            background: var(--gradient-1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .logo p {
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-top: 0.25rem;
        }

        .header-actions {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        /* Navigation Tabs */
        .nav-tabs {
            display: flex;
            gap: 0.5rem;
            background: var(--bg-secondary);
            padding: 0.5rem;
            border-radius: 12px;
            margin-bottom: 2rem;
        }

        .nav-tab {
            padding: 0.75rem 1.5rem;
            border: none;
            background: transparent;
            color: var(--text-secondary);
            font-size: 0.9rem;
            font-weight: 500;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .nav-tab:hover { color: var(--text-primary); background: var(--bg-card-hover); }
        .nav-tab.active { background: var(--accent); color: white; }

        /* Buttons */
        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 10px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: var(--accent);
            color: white;
        }
        .btn-primary:hover { background: var(--accent-hover); transform: translateY(-1px); }

        .btn-secondary {
            background: var(--bg-card);
            color: var(--text-primary);
            border: 1px solid var(--border);
        }
        .btn-secondary:hover { background: var(--bg-card-hover); }

        .btn-icon {
            width: 40px;
            height: 40px;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s;
        }
        .btn-icon:hover { background: var(--bg-card-hover); color: var(--text-primary); }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 1.5rem;
            border: 1px solid var(--border);
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
        }

        .stat-card:nth-child(1)::before { background: var(--gradient-1); }
        .stat-card:nth-child(2)::before { background: var(--gradient-3); }
        .stat-card:nth-child(3)::before { background: var(--gradient-4); }
        .stat-card:nth-child(4)::before { background: var(--gradient-2); }

        .stat-card:hover { transform: translateY(-4px); box-shadow: 0 12px 40px rgba(0,0,0,0.2); }

        .stat-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }

        .stat-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .stat-card:nth-child(1) .stat-icon { background: rgba(102, 126, 234, 0.2); }
        .stat-card:nth-child(2) .stat-icon { background: rgba(79, 172, 254, 0.2); }
        .stat-card:nth-child(3) .stat-icon { background: rgba(67, 233, 123, 0.2); }
        .stat-card:nth-child(4) .stat-icon { background: rgba(240, 147, 251, 0.2); }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 800;
            line-height: 1;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.9rem;
            font-weight: 500;
        }

        .stat-change {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            font-size: 0.8rem;
            padding: 0.25rem 0.5rem;
            border-radius: 6px;
            font-weight: 600;
        }

        .stat-change.positive { background: rgba(16, 185, 129, 0.2); color: var(--success); }
        .stat-change.neutral { background: rgba(148, 163, 184, 0.2); color: var(--text-secondary); }

        /* Panels */
        .panel {
            background: var(--bg-card);
            border-radius: 16px;
            border: 1px solid var(--border);
            overflow: hidden;
        }

        .panel-header {
            padding: 1.25rem 1.5rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .panel-title {
            font-size: 1.1rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .panel-body { padding: 1.5rem; }

        /* Webhook List */
        .webhook-list {
            display: flex;
            flex-direction: column;
        }

        .webhook-item {
            display: grid;
            grid-template-columns: auto 1fr auto auto;
            gap: 1rem;
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--border);
            align-items: center;
            cursor: pointer;
            transition: background 0.2s;
        }

        .webhook-item:hover { background: var(--bg-card-hover); }
        .webhook-item:last-child { border-bottom: none; }

        .webhook-method {
            font-size: 0.75rem;
            font-weight: 700;
            padding: 0.35rem 0.75rem;
            border-radius: 6px;
            background: rgba(59, 130, 246, 0.2);
            color: var(--accent);
            text-transform: uppercase;
        }

        .webhook-info h4 {
            font-weight: 600;
            margin-bottom: 0.25rem;
            font-size: 0.95rem;
        }

        .webhook-info p {
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        .webhook-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }
        .status-dot.valid { background: var(--success); box-shadow: 0 0 8px var(--success); }
        .status-dot.invalid { background: var(--danger); box-shadow: 0 0 8px var(--danger); }

        .webhook-time {
            font-size: 0.85rem;
            color: var(--text-muted);
            text-align: right;
        }

        /* Security Status */
        .security-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .security-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: var(--bg-secondary);
            border-radius: 12px;
            border: 1px solid var(--border);
        }

        .security-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
        }

        .security-icon.enabled { background: rgba(16, 185, 129, 0.2); }
        .security-icon.disabled { background: rgba(148, 163, 184, 0.15); }

        .security-info h4 { font-weight: 600; font-size: 0.9rem; }
        .security-info p { font-size: 0.8rem; color: var(--text-muted); }

        /* Toggle Switch */
        .toggle {
            position: relative;
            width: 48px;
            height: 26px;
        }

        .toggle input { opacity: 0; width: 0; height: 0; }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            inset: 0;
            background: var(--border);
            border-radius: 26px;
            transition: 0.3s;
        }

        .toggle-slider::before {
            content: '';
            position: absolute;
            height: 20px;
            width: 20px;
            left: 3px;
            bottom: 3px;
            background: white;
            border-radius: 50%;
            transition: 0.3s;
        }

        .toggle input:checked + .toggle-slider { background: var(--success); }
        .toggle input:checked + .toggle-slider::before { transform: translateX(22px); }

        /* Form Controls */
        .form-input {
            padding: 0.5rem 0.75rem;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: var(--bg-primary);
            color: var(--text-primary);
            font-size: 0.9rem;
            min-width: 120px;
            transition: border-color 0.2s;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--accent);
        }

        .form-input[type="number"] {
            width: 100px;
            text-align: right;
        }

        .form-input.wide {
            width: 200px;
        }

        .form-textarea {
            padding: 0.5rem 0.75rem;
            border: 1px solid var(--border);
            border-radius: 8px;
            background: var(--bg-primary);
            color: var(--text-primary);
            font-size: 0.9rem;
            font-family: 'Fira Code', 'Monaco', monospace;
            min-height: 60px;
            resize: vertical;
            width: 100%;
        }

        .form-textarea:focus {
            outline: none;
            border-color: var(--accent);
        }

        .config-actions {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--border);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }
        .btn-success:hover { background: #059669; transform: translateY(-1px); }

        .btn-success:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .save-status {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .save-status.success { color: var(--success); }
        .save-status.error { color: var(--danger); }

        .config-hint {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-top: 0.25rem;
        }

        /* Configuration Panel */
        .config-section {
            margin-bottom: 2rem;
        }

        .config-section:last-child { margin-bottom: 0; }

        .config-section-title {
            font-size: 1rem;
            font-weight: 700;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--text-primary);
        }

        .config-group {
            display: grid;
            gap: 1rem;
        }

        .config-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            background: var(--bg-secondary);
            border-radius: 10px;
            border: 1px solid var(--border);
        }

        .config-item-info h4 {
            font-weight: 600;
            margin-bottom: 0.25rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .config-item-info p {
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        /* Tooltip Styles */
        .tooltip-trigger {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 18px;
            height: 18px;
            background: var(--accent);
            color: white;
            border-radius: 50%;
            font-size: 0.7rem;
            font-weight: 700;
            cursor: help;
            position: relative;
            flex-shrink: 0;
        }

        .tooltip-trigger:hover {
            background: var(--accent-hover);
        }

        .tooltip-trigger .tooltip-content {
            display: none;
            position: absolute;
            left: 50%;
            bottom: calc(100% + 10px);
            transform: translateX(-50%);
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1rem;
            width: 320px;
            z-index: 100;
            text-align: left;
            font-weight: 400;
        }

        .tooltip-trigger:hover .tooltip-content {
            display: block;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        .tooltip-trigger .tooltip-content::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 8px solid transparent;
            border-top-color: var(--border);
        }

        .tooltip-title {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .tooltip-title span {
            font-size: 1rem;
        }

        .tooltip-desc {
            font-size: 0.85rem;
            color: var(--text-secondary);
            line-height: 1.5;
            margin-bottom: 0.75rem;
        }

        .tooltip-example {
            background: var(--bg-secondary);
            border-radius: 8px;
            padding: 0.75rem;
            border-left: 3px solid var(--accent);
        }

        .tooltip-example-label {
            font-size: 0.7rem;
            font-weight: 600;
            color: var(--accent);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 0.35rem;
        }

        .tooltip-example-text {
            font-size: 0.8rem;
            color: var(--text-primary);
            line-height: 1.4;
        }

        /* Responsive tooltip positioning */
        @media (max-width: 768px) {
            .tooltip-trigger .tooltip-content {
                width: 260px;
                left: auto;
                right: -10px;
                transform: none;
            }
            .tooltip-trigger .tooltip-content::after {
                left: auto;
                right: 15px;
                transform: none;
            }
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(4px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }

        .modal-overlay.active { opacity: 1; visibility: visible; }

        .modal {
            background: var(--bg-card);
            border-radius: 20px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow: hidden;
            transform: scale(0.9);
            transition: transform 0.3s;
            border: 1px solid var(--border);
        }

        .modal-overlay.active .modal { transform: scale(1); }

        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title { font-size: 1.25rem; font-weight: 700; }

        .modal-close {
            width: 36px;
            height: 36px;
            border: none;
            background: var(--bg-secondary);
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
            transition: all 0.2s;
        }

        .modal-close:hover { background: var(--danger); color: white; }

        .modal-body {
            padding: 1.5rem;
            max-height: 60vh;
            overflow-y: auto;
        }

        /* Code Block */
        .code-block {
            background: #0d1117;
            border-radius: 12px;
            overflow: hidden;
            margin: 1rem 0;
        }

        .code-header {
            padding: 0.75rem 1rem;
            background: rgba(255,255,255,0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        .code-content {
            padding: 1rem;
            overflow-x: auto;
            font-family: 'Fira Code', 'Monaco', monospace;
            font-size: 0.9rem;
            line-height: 1.6;
        }

        /* Help Section */
        .help-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
        }

        .help-card {
            background: var(--bg-secondary);
            border-radius: 16px;
            padding: 1.5rem;
            border: 1px solid var(--border);
            transition: all 0.3s;
        }

        .help-card:hover { transform: translateY(-4px); border-color: var(--accent); }

        .help-card-icon {
            width: 56px;
            height: 56px;
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.75rem;
            margin-bottom: 1rem;
        }

        .help-card:nth-child(1) .help-card-icon { background: var(--gradient-1); }
        .help-card:nth-child(2) .help-card-icon { background: var(--gradient-3); }
        .help-card:nth-child(3) .help-card-icon { background: var(--gradient-4); }
        .help-card:nth-child(4) .help-card-icon { background: var(--gradient-2); }

        .help-card h3 { font-size: 1.1rem; font-weight: 700; margin-bottom: 0.5rem; }
        .help-card p { color: var(--text-secondary); font-size: 0.9rem; line-height: 1.6; }

        /* Endpoint Display */
        .endpoint-display {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 1.25rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            border: 1px solid var(--border);
            margin-bottom: 1.5rem;
        }

        .endpoint-method {
            background: var(--success);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-weight: 700;
            font-size: 0.85rem;
        }

        .endpoint-url {
            flex: 1;
            font-family: 'Fira Code', monospace;
            font-size: 1rem;
            color: var(--text-primary);
            word-break: break-all;
        }

        .copy-btn {
            padding: 0.5rem 1rem;
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
        }

        .copy-btn:hover { background: var(--accent-hover); }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 1.5rem;
            opacity: 0.5;
        }

        .empty-state h3 { font-size: 1.25rem; margin-bottom: 0.5rem; }
        .empty-state p { color: var(--text-muted); margin-bottom: 1.5rem; }

        /* Toast */
        .toast-container {
            position: fixed;
            top: 1.5rem;
            right: 1.5rem;
            z-index: 2000;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .toast {
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 1rem 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .toast.success { border-left: 4px solid var(--success); }
        .toast.error { border-left: 4px solid var(--danger); }

        /* Loading Spinner */
        .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid var(--border);
            border-top-color: var(--accent);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin { to { transform: rotate(360deg); } }

        /* Live indicator */
        .live-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.85rem;
            color: var(--success);
            font-weight: 600;
        }

        .live-dot {
            width: 8px;
            height: 8px;
            background: var(--success);
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(1.2); }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container { padding: 1rem; }
            header { flex-direction: column; gap: 1rem; text-align: center; }
            .header-actions { width: 100%; justify-content: center; }
            .nav-tabs { flex-wrap: wrap; justify-content: center; }
            .stats-grid { grid-template-columns: 1fr 1fr; }
            .stat-value { font-size: 2rem; }
            .webhook-item { grid-template-columns: 1fr; gap: 0.5rem; }
        }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: var(--bg-secondary); }
        ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: var(--text-muted); }

        /* Tab content */
        .tab-content { display: none; }
        .tab-content.active { display: block; }

        /* Grid layouts */
        .grid-2 { display: grid; grid-template-columns: 2fr 1fr; gap: 1.5rem; }
        @media (max-width: 1024px) { .grid-2 { grid-template-columns: 1fr; } }

        /* Detail view */
        .detail-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .detail-item {
            padding: 1rem;
            background: var(--bg-secondary);
            border-radius: 10px;
        }

        .detail-item label {
            display: block;
            font-size: 0.75rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 0.25rem;
        }

        .detail-item span {
            font-size: 1rem;
            font-weight: 600;
        }

        .headers-list {
            display: grid;
            gap: 0.5rem;
        }

        .header-row {
            display: grid;
            grid-template-columns: 200px 1fr;
            gap: 1rem;
            padding: 0.75rem;
            background: var(--bg-secondary);
            border-radius: 8px;
            font-size: 0.9rem;
        }

        .header-row .key {
            font-weight: 600;
            color: var(--accent);
        }

        .header-row .value {
            color: var(--text-secondary);
            word-break: break-all;
        }
    </style>
</head>
<body>
    <div class="bg-pattern"></div>
    <div class="toast-container" id="toastContainer"></div>

    <div class="container">
        <header>
            <div class="logo">
                <div class="logo-icon">&#9889;</div>
                <div>
                    <h1>VOLWebHook</h1>
                    <p>Enterprise Webhook Capture Service</p>
                </div>
            </div>
            <div class="header-actions">
                <div class="live-indicator">
                    <span class="live-dot"></span>
                    <span>Live</span>
                </div>
                <button class="btn-icon" onclick="toggleTheme()" title="Toggle theme">
                    <span id="themeIcon">&#9790;</span>
                </button>
                <button class="btn btn-primary" onclick="sendTestWebhook()">
                    <span>&#9889;</span> Send Test
                </button>
            </div>
        </header>

        <nav class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('dashboard', event)">
                <span>&#128200;</span> Dashboard
            </button>
            <button class="nav-tab" onclick="showTab('webhooks', event)">
                <span>&#128229;</span> Webhooks
            </button>
            <button class="nav-tab" onclick="showTab('config', event)">
                <span>&#9881;</span> Configuration
            </button>
            <button class="nav-tab" onclick="showTab('help', event)">
                <span>&#10067;</span> Help
            </button>
        </nav>

        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon">&#128229;</div>
                        <span class="stat-change positive" id="todayChange">+0 today</span>
                    </div>
                    <div class="stat-value" id="totalWebhooks">-</div>
                    <div class="stat-label">Total Webhooks</div>
                </div>
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon">&#128337;</div>
                    </div>
                    <div class="stat-value" id="lastHourWebhooks">-</div>
                    <div class="stat-label">Last Hour</div>
                </div>
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon">&#128190;</div>
                    </div>
                    <div class="stat-value" id="storageUsed">-</div>
                    <div class="stat-label">Storage Used</div>
                </div>
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon">&#9889;</div>
                    </div>
                    <div class="stat-value" id="uptime">-</div>
                    <div class="stat-label">Uptime</div>
                </div>
            </div>

            <div class="grid-2">
                <div class="panel">
                    <div class="panel-header">
                        <div class="panel-title">
                            <span>&#128229;</span> Recent Webhooks
                        </div>
                        <button class="btn btn-secondary" onclick="refreshWebhooks()">
                            <span>&#8635;</span> Refresh
                        </button>
                    </div>
                    <div class="webhook-list" id="recentWebhooks">
                        <div class="empty-state">
                            <div class="spinner"></div>
                            <p style="margin-top: 1rem;">Loading webhooks...</p>
                        </div>
                    </div>
                </div>

                <div class="panel">
                    <div class="panel-header">
                        <div class="panel-title">
                            <span>&#128274;</span> Security Status
                        </div>
                    </div>
                    <div class="panel-body">
                        <div class="security-grid" id="securityStatus">
                            <div class="security-item">
                                <div class="spinner"></div>
                                <div class="security-info">
                                    <h4>Loading...</h4>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Webhooks Tab -->
        <div id="webhooks" class="tab-content">
            <div class="panel">
                <div class="panel-header">
                    <div class="panel-title">
                        <span>&#128229;</span> All Webhooks
                    </div>
                    <div style="display: flex; gap: 1rem; align-items: center;">
                        <input type="text" id="searchInput" placeholder="Search webhooks..."
                            style="padding: 0.5rem 1rem; border-radius: 8px; border: 1px solid var(--border); background: var(--bg-secondary); color: var(--text-primary); width: 250px;"
                            onkeyup="searchWebhooks(this.value)">
                        <button class="btn btn-secondary" onclick="refreshWebhooks()">
                            <span>&#8635;</span> Refresh
                        </button>
                    </div>
                </div>
                <div class="webhook-list" id="allWebhooks">
                    <div class="empty-state">
                        <div class="spinner"></div>
                        <p style="margin-top: 1rem;">Loading webhooks...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Configuration Tab -->
        <div id="config" class="tab-content">
            <div class="endpoint-display">
                <span class="endpoint-method">POST</span>
                <span class="endpoint-url" id="webhookUrl">Loading...</span>
                <button class="copy-btn" onclick="copyEndpoint()">&#128203; Copy</button>
            </div>

            <div class="panel">
                <div class="panel-header">
                    <div class="panel-title">
                        <span>&#9881;</span> Current Configuration
                    </div>
                </div>
                <div class="panel-body" id="configContent">
                    <div class="empty-state">
                        <div class="spinner"></div>
                        <p style="margin-top: 1rem;">Loading configuration...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Help Tab -->
        <div id="help" class="tab-content">
            <div class="help-cards">
                <div class="help-card">
                    <div class="help-card-icon">&#128640;</div>
                    <h3>What is VOLWebHook?</h3>
                    <p>VOLWebHook is an enterprise-grade webhook capture service. It receives HTTP requests from external services (like payment providers, CI/CD tools, or any API) and stores them for inspection and debugging.</p>
                </div>
                <div class="help-card">
                    <div class="help-card-icon">&#128301;</div>
                    <h3>How to Send Webhooks</h3>
                    <p>Send a POST request to the webhook endpoint with any JSON payload. Each request is captured with full headers, body, and metadata. Use the "Send Test" button to try it out!</p>
                </div>
                <div class="help-card">
                    <div class="help-card-icon">&#128274;</div>
                    <h3>Security Features</h3>
                    <p>Enable IP allowlisting, API key authentication, HMAC signature verification, and rate limiting to secure your webhook endpoint against unauthorized access.</p>
                </div>
                <div class="help-card">
                    <div class="help-card-icon">&#128202;</div>
                    <h3>Viewing Data</h3>
                    <p>Click on any webhook in the list to see full details including headers, parsed JSON body, source IP, and timestamps. Search and filter to find specific requests.</p>
                </div>
            </div>

            <div class="panel" style="margin-top: 2rem;">
                <div class="panel-header">
                    <div class="panel-title">
                        <span>&#128187;</span> Quick Start - cURL Example
                    </div>
                </div>
                <div class="panel-body">
                    <div class="code-block">
                        <div class="code-header">
                            <span>bash</span>
                            <button class="copy-btn" onclick="copyCurl()">Copy</button>
                        </div>
                        <pre class="code-content" id="curlExample">Loading...</pre>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Webhook Detail Modal -->
    <div class="modal-overlay" id="webhookModal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">Webhook Details</h2>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body" id="webhookModalContent">
                <!-- Content loaded dynamically -->
            </div>
        </div>
    </div>

    <script>
        // State
        let currentTheme = localStorage.getItem('theme') || 'dark';
        let stats = null;
        let config = null;
        let webhooks = [];
        let refreshInterval = null;

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            applyTheme();
            loadAllData();
            startAutoRefresh();
        });

        // Theme
        function toggleTheme() {
            currentTheme = currentTheme === 'dark' ? 'light' : 'dark';
            localStorage.setItem('theme', currentTheme);
            applyTheme();
        }

        function applyTheme() {
            document.body.classList.toggle('light-mode', currentTheme === 'light');
            document.getElementById('themeIcon').textContent = currentTheme === 'dark' ? 'â˜€ï¸' : 'ðŸŒ™';
        }

        // Tabs
        function showTab(tabId, event) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            if (event) {
                event.target.closest('.nav-tab').classList.add('active');
            }
        }

        // API Calls
        async function fetchAPI(endpoint) {
            try {
                const response = await fetch(`/api/dashboard/${endpoint}`);
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                return await response.json();
            } catch (error) {
                console.error(`API Error (${endpoint}):`, error);
                return null;
            }
        }

        async function loadAllData() {
            const [statsData, configData, webhooksData, endpointData] = await Promise.all([
                fetchAPI('stats'),
                fetchAPI('config'),
                fetchAPI('webhooks?limit=50'),
                fetchAPI('endpoint-info')
            ]);

            if (statsData) updateStats(statsData);
            if (configData) updateConfig(configData);
            if (webhooksData) updateWebhooks(webhooksData.webhooks);
            if (endpointData) updateEndpoint(endpointData);
        }

        function updateStats(data) {
            stats = data;
            document.getElementById('totalWebhooks').textContent = data.webhooks.total.toLocaleString();
            document.getElementById('lastHourWebhooks').textContent = data.webhooks.lastHour.toLocaleString();
            document.getElementById('storageUsed').textContent = data.storage.totalFormatted;
            document.getElementById('uptime').textContent = data.uptimeFormatted;
            document.getElementById('todayChange').textContent = `+${data.webhooks.today} today`;

            // Security status
            const securityHtml = `
                <div class="security-item">
                    <div class="security-icon ${data.security.ipAllowlist ? 'enabled' : 'disabled'}">&#127760;</div>
                    <div class="security-info">
                        <h4>IP Allowlist</h4>
                        <p>${data.security.ipAllowlist ? 'Enabled' : 'Disabled'}</p>
                    </div>
                </div>
                <div class="security-item">
                    <div class="security-icon ${data.security.apiKey ? 'enabled' : 'disabled'}">&#128273;</div>
                    <div class="security-info">
                        <h4>API Key Auth</h4>
                        <p>${data.security.apiKey ? 'Enabled' : 'Disabled'}</p>
                    </div>
                </div>
                <div class="security-item">
                    <div class="security-icon ${data.security.hmac ? 'enabled' : 'disabled'}">&#128272;</div>
                    <div class="security-info">
                        <h4>HMAC Signature</h4>
                        <p>${data.security.hmac ? 'Enabled' : 'Disabled'}</p>
                    </div>
                </div>
                <div class="security-item">
                    <div class="security-icon ${data.security.rateLimit ? 'enabled' : 'disabled'}">&#9201;</div>
                    <div class="security-info">
                        <h4>Rate Limiting</h4>
                        <p>${data.security.rateLimit ? 'Enabled' : 'Disabled'}</p>
                    </div>
                </div>
            `;
            document.getElementById('securityStatus').innerHTML = securityHtml;
        }

        function updateWebhooks(data) {
            webhooks = data;
            renderWebhooks('recentWebhooks', data.slice(0, 10));
            renderWebhooks('allWebhooks', data);
        }

        function renderWebhooks(containerId, data) {
            const container = document.getElementById(containerId);

            if (!data || data.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">&#128229;</div>
                        <h3>No Webhooks Yet</h3>
                        <p>Send your first webhook to see it here</p>
                        <button class="btn btn-primary" onclick="sendTestWebhook()">
                            &#9889; Send Test Webhook
                        </button>
                    </div>
                `;
                return;
            }

            container.innerHTML = data.map(w => `
                <div class="webhook-item" onclick="viewWebhook('${w.id}')">
                    <span class="webhook-method">${w.httpMethod}</span>
                    <div class="webhook-info">
                        <h4>${w.path}${w.queryString ? '?' + w.queryString : ''}</h4>
                        <p>${w.sourceIpAddress} &bull; ${w.contentLengthFormatted}</p>
                    </div>
                    <div class="webhook-status">
                        <span class="status-dot ${w.isValidJson ? 'valid' : 'invalid'}"></span>
                        <span style="font-size: 0.8rem; color: var(--text-muted)">
                            ${w.isValidJson ? 'Valid JSON' : 'Invalid'}
                        </span>
                    </div>
                    <div class="webhook-time">${w.receivedAtFormatted}</div>
                </div>
            `).join('');
        }

        // Tooltip helper function
        function tooltip(title, desc, example) {
            return `<span class="tooltip-trigger">?
                <div class="tooltip-content">
                    <div class="tooltip-title"><span>&#128161;</span> ${title}</div>
                    <div class="tooltip-desc">${desc}</div>
                    <div class="tooltip-example">
                        <div class="tooltip-example-label">Real Example</div>
                        <div class="tooltip-example-text">${example}</div>
                    </div>
                </div>
            </span>`;
        }

        function updateConfig(data) {
            config = data;

            // Build config HTML with proper tooltip function calls
            const configHtml = `
                <form id="configForm" onsubmit="saveConfiguration(event)">
                    <div class="config-section">
                        <h3 class="config-section-title">&#128229; Webhook Settings</h3>
                        <div class="config-group">
                            <div class="config-item">
                                <div class="config-item-info">
                                    <h4>Max Payload Size (MB) ${tooltip(
                                        'Maximum Data Size',
                                        'The biggest chunk of data someone can send in a single webhook. Think of it like a mailbox - if the package is too big, it won\'t fit.',
                                        'If set to 10 MB, someone trying to send a 15 MB file will be rejected. A typical JSON webhook from Stripe or GitHub is usually less than 1 MB.'
                                    )}</h4>
                                    <p>Maximum allowed request body size</p>
                                </div>
                                <input type="number" class="form-input" id="cfg-maxPayloadSizeMB"
                                    value="${data.webhook.maxPayloadSizeMB}" min="1" max="100">
                            </div>
                            <div class="config-item">
                                <div class="config-item-info">
                                    <h4>Storage Persistence ${tooltip(
                                        'Save Data to Disk',
                                        'When ON, webhooks are saved to your hard drive and survive server restarts. When OFF, all webhooks disappear when the server stops.',
                                        'If your server crashes at 3am and this is ON, you won\'t lose any webhook data. If it\'s OFF, everything received before the crash is gone.'
                                    )}</h4>
                                    <p>Save webhooks to disk</p>
                                </div>
                                <label class="toggle">
                                    <input type="checkbox" id="cfg-enablePayloadPersistence"
                                        ${data.webhook.enablePayloadPersistence ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="config-item">
                                <div class="config-item-info">
                                    <h4>Retention Period (days) ${tooltip(
                                        'Auto-Delete Old Data',
                                        'How many days to keep webhooks before automatically deleting them. Like setting an expiration date on saved emails to free up space.',
                                        'Set to 30 days means: A webhook received today will be automatically deleted 30 days from now. Good for keeping your storage under control.'
                                    )}</h4>
                                    <p>How long to keep webhook data</p>
                                </div>
                                <input type="number" class="form-input" id="cfg-payloadRetentionDays"
                                    value="${data.webhook.payloadRetentionDays}" min="1" max="365">
                            </div>
                            <div class="config-item">
                                <div class="config-item-info">
                                    <h4>Always Return 200 ${tooltip(
                                        'Always Say Success',
                                        'When ON, always tells senders "success" even if something went wrong internally. Prevents external services from retrying endlessly.',
                                        'PayPal sends you a payment webhook. If there\'s an internal error and you return "failed," PayPal will keep retrying for hours. With this ON, PayPal thinks it worked and moves on.'
                                    )}</h4>
                                    <p>Return success even on errors</p>
                                </div>
                                <label class="toggle">
                                    <input type="checkbox" id="cfg-alwaysReturn200"
                                        ${data.webhook.alwaysReturn200 ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="config-section">
                        <h3 class="config-section-title">&#128274; Security - IP Allowlist</h3>
                        <div class="config-group">
                            <div class="config-item">
                                <div class="config-item-info">
                                    <h4>Enable IP Allowlist ${tooltip(
                                        'Guest List for Computers',
                                        'Only allow specific computer addresses (IPs) to send webhooks. Like a VIP list at a club - if you\'re not on the list, you can\'t get in.',
                                        'Turn this ON and add "52.31.14.0" to allow only GitHub\'s servers. Random hackers trying to send fake webhooks from other IPs will be blocked.'
                                    )}</h4>
                                    <p>Restrict access by IP address</p>
                                </div>
                                <label class="toggle">
                                    <input type="checkbox" id="cfg-ipAllowlistEnabled"
                                        ${data.security.ipAllowlist.enabled ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="config-item" style="flex-direction: column; align-items: stretch; gap: 0.5rem;">
                                <div class="config-item-info">
                                    <h4>Allowed IPs ${tooltip(
                                        'Specific Allowed Addresses',
                                        'A list of exact computer addresses that can send webhooks. Each IP is like a specific house address.',
                                        'Add "192.168.1.50" to allow only your office computer. Add "140.82.112.1" to allow a specific GitHub server. One address per line.'
                                    )}</h4>
                                    <p class="config-hint">One IP per line (e.g., 192.168.1.100)</p>
                                </div>
                                <textarea class="form-textarea" id="cfg-allowedIps" rows="2"
                                    placeholder="Enter IPs, one per line">${(data.security.ipAllowlist.allowedIps || []).join('\n')}</textarea>
                            </div>
                            <div class="config-item" style="flex-direction: column; align-items: stretch; gap: 0.5rem;">
                                <div class="config-item-info">
                                    <h4>Allowed CIDRs ${tooltip(
                                        'Allowed Address Ranges',
                                        'Instead of listing every single IP, you can allow a whole range. It\'s like saying "everyone from this neighborhood" instead of listing every house.',
                                        '192.168.1.0/24 = all addresses from 192.168.1.0 to 192.168.1.255 (your whole office network). 10.0.0.0/8 = all addresses starting with 10 (common for internal networks).'
                                    )}</h4>
                                    <p class="config-hint">One CIDR per line (e.g., 10.0.0.0/8)</p>
                                </div>
                                <textarea class="form-textarea" id="cfg-allowedCidrs" rows="2"
                                    placeholder="Enter CIDRs, one per line">${(data.security.ipAllowlist.allowedCidrs || []).join('\n')}</textarea>
                            </div>
                            <div class="config-item">
                                <div class="config-item-info">
                                    <h4>Allow Private Networks ${tooltip(
                                        'Allow Local/Internal Access',
                                        'Private networks are internal addresses like your home WiFi or office LAN. They\'re not accessible from the internet.',
                                        'ON = Computers on your local network (192.168.x.x, 10.x.x.x) can send webhooks. OFF = Only public internet addresses work. Keep ON for testing, consider OFF for production.'
                                    )}</h4>
                                    <p>Allow requests from private IP ranges</p>
                                </div>
                                <label class="toggle">
                                    <input type="checkbox" id="cfg-allowPrivateNetworks"
                                        ${data.security.ipAllowlist.allowPrivateNetworks ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="config-section">
                        <h3 class="config-section-title">&#128273; API Key Authentication</h3>
                        <div class="config-group">
                            <div class="config-item">
                                <div class="config-item-info">
                                    <h4>Enable API Key Auth ${tooltip(
                                        'Require a Password',
                                        'When ON, every webhook request must include a secret password (API key). Without it, the request is rejected.',
                                        'You give Shopify your API key "sk_abc123". Shopify includes it in every webhook it sends. Anyone without this key can\'t send you fake orders.'
                                    )}</h4>
                                    <p>Require API key for webhook requests</p>
                                </div>
                                <label class="toggle">
                                    <input type="checkbox" id="cfg-apiKeyEnabled"
                                        ${data.security.apiKey.enabled ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="config-item">
                                <div class="config-item-info">
                                    <h4>Header Name ${tooltip(
                                        'Where to Look for the Key',
                                        'HTTP headers are like labels on an envelope. This tells the system which label to check for the API key.',
                                        'Default "X-API-Key" means requests should include: X-API-Key: your-secret-key. Some services use "Authorization" or custom names like "X-Webhook-Token".'
                                    )}</h4>
                                    <p>HTTP header containing the API key</p>
                                </div>
                                <input type="text" class="form-input wide" id="cfg-apiKeyHeaderName"
                                    value="${data.security.apiKey.headerName}" placeholder="X-API-Key">
                            </div>
                            <div class="config-item" style="flex-direction: column; align-items: stretch; gap: 0.5rem;">
                                <div class="config-item-info">
                                    <h4>Valid API Keys ${tooltip(
                                        'List of Accepted Passwords',
                                        'All the API keys that will be accepted. You can have multiple keys for different services or team members.',
                                        'Add "key_for_stripe" and "key_for_github" on separate lines. Now both Stripe and GitHub can send webhooks, each with their own key. If someone leaves the team, just remove their key.'
                                    )}</h4>
                                    <p class="config-hint">One key per line. Current keys: ${data.security.apiKey.keyCount}. Leave empty to keep existing keys.</p>
                                </div>
                                <textarea class="form-textarea" id="cfg-validKeys" rows="2"
                                    placeholder="Enter new API keys (one per line) to replace existing keys"></textarea>
                            </div>
                            <div class="config-item" style="flex-direction: column; align-items: stretch; gap: 0.75rem;">
                                <div class="config-item-info">
                                    <h4>Generate New API Key ${tooltip(
                                        'Create a New Password',
                                        'Generates a random, secure API key and automatically adds it to your allowed list. Much safer than making up your own password.',
                                        'Click the button, get something like "vwh_a8f3k2m9x7...". Copy it immediately and paste it into your webhook service (Stripe, GitHub, etc). It\'s only shown once!'
                                    )}</h4>
                                    <p class="config-hint">Create a new secure API key and automatically add it to the allowed list.</p>
                                </div>
                                <div style="display: flex; gap: 0.75rem; align-items: center; flex-wrap: wrap;">
                                    <button type="button" class="btn btn-success" id="btn-generate-api-key" onclick="generateApiKey()">
                                        &#128273; Generate API Key
                                    </button>
                                    <div id="generated-key-container" style="display: none; flex: 1; min-width: 300px;">
                                        <div style="display: flex; gap: 0.5rem; align-items: center;">
                                            <input type="text" class="form-input" id="generated-api-key" readonly
                                                style="flex: 1; font-family: 'Fira Code', monospace; font-size: 0.85rem;">
                                            <button type="button" class="btn btn-secondary" onclick="copyApiKey()" title="Copy to clipboard">
                                                &#128203; Copy
                                            </button>
                                        </div>
                                        <p class="config-hint" style="margin-top: 0.5rem; color: var(--warning);">
                                            &#9888; Copy this key now - it won't be shown again!
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="config-section">
                        <h3 class="config-section-title">&#128272; HMAC Signature Verification</h3>
                        <div class="config-group">
                            <div class="config-item">
                                <div class="config-item-info">
                                    <h4>Enable HMAC Verification ${tooltip(
                                        'Verify Sender Identity',
                                        'HMAC is a cryptographic way to prove a message is genuine and hasn\'t been tampered with. Like a wax seal on a letter that breaks if someone opens it.',
                                        'GitHub sends a webhook about a new commit. It creates a special signature using a secret only you and GitHub know. If someone tries to fake a GitHub webhook, the signature won\'t match.'
                                    )}</h4>
                                    <p>Verify request signatures</p>
                                </div>
                                <label class="toggle">
                                    <input type="checkbox" id="cfg-hmacEnabled"
                                        ${data.security.hmac.enabled ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="config-item">
                                <div class="config-item-info">
                                    <h4>Signature Header ${tooltip(
                                        'Where to Find the Signature',
                                        'The HTTP header name where the sender puts their cryptographic signature.',
                                        'GitHub uses "X-Hub-Signature-256", Stripe uses "Stripe-Signature", Shopify uses "X-Shopify-Hmac-SHA256". Check your webhook provider\'s docs for the right header name.'
                                    )}</h4>
                                    <p>HTTP header containing the signature</p>
                                </div>
                                <input type="text" class="form-input wide" id="cfg-hmacHeaderName"
                                    value="${data.security.hmac.headerName}" placeholder="X-Signature">
                            </div>
                            <div class="config-item">
                                <div class="config-item-info">
                                    <h4>Algorithm ${tooltip(
                                        'Encryption Strength',
                                        'The mathematical method used to create signatures. Higher numbers = stronger security, but all three are secure for normal use.',
                                        'SHA256 is the most common and what GitHub/Stripe use. SHA512 is strongest but rarely needed. Match whatever your webhook provider uses.'
                                    )}</h4>
                                    <p>HMAC algorithm to use</p>
                                </div>
                                <select class="form-input" id="cfg-hmacAlgorithm">
                                    <option value="HMACSHA256" ${data.security.hmac.algorithm === 'HMACSHA256' ? 'selected' : ''}>HMACSHA256</option>
                                    <option value="HMACSHA384" ${data.security.hmac.algorithm === 'HMACSHA384' ? 'selected' : ''}>HMACSHA384</option>
                                    <option value="HMACSHA512" ${data.security.hmac.algorithm === 'HMACSHA512' ? 'selected' : ''}>HMACSHA512</option>
                                </select>
                            </div>
                            <div class="config-item">
                                <div class="config-item-info">
                                    <h4>Shared Secret ${tooltip(
                                        'The Secret Password',
                                        'A password that both you and the sender know. The sender uses it to sign messages, and you use it to verify them. Never share this publicly!',
                                        'You set secret to "my_super_secret_123" here AND in GitHub\'s webhook settings. GitHub signs every webhook with this secret. If someone doesn\'t know the secret, they can\'t fake a valid signature.'
                                    )}</h4>
                                    <p class="config-hint">${data.security.hmac.hasSecret ? 'Secret is configured' : 'No secret configured'}. Leave empty to keep existing.</p>
                                </div>
                                <input type="password" class="form-input wide" id="cfg-hmacSharedSecret"
                                    placeholder="Enter new secret to change">
                            </div>
                        </div>
                    </div>

                    <div class="config-section">
                        <h3 class="config-section-title">&#9201; Rate Limiting</h3>
                        <div class="config-group">
                            <div class="config-item">
                                <div class="config-item-info">
                                    <h4>Enable Rate Limiting ${tooltip(
                                        'Prevent Overload',
                                        'Limits how many webhooks can be received in a time period. Protects your server from being overwhelmed by too many requests.',
                                        'Without rate limiting, a buggy service might send 10,000 webhooks per second and crash your server. With it enabled, excess requests are rejected with "too many requests" error.'
                                    )}</h4>
                                    <p>Limit requests per time period</p>
                                </div>
                                <label class="toggle">
                                    <input type="checkbox" id="cfg-rateLimitEnabled"
                                        ${data.security.rateLimit.enabled ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="config-item">
                                <div class="config-item-info">
                                    <h4>Requests per Minute ${tooltip(
                                        'Per-Minute Speed Limit',
                                        'Maximum number of webhooks allowed in any 60-second window. After hitting the limit, new requests are rejected until the minute resets.',
                                        'Set to 100: In the first 10 seconds, 100 webhooks arrive. For the next 50 seconds, all new webhooks get "429 Too Many Requests" error. Then the counter resets.'
                                    )}</h4>
                                    <p>Maximum requests allowed per minute</p>
                                </div>
                                <input type="number" class="form-input" id="cfg-requestsPerMinute"
                                    value="${data.security.rateLimit.requestsPerMinute}" min="1" max="10000">
                            </div>
                            <div class="config-item">
                                <div class="config-item-info">
                                    <h4>Requests per Hour ${tooltip(
                                        'Per-Hour Speed Limit',
                                        'Maximum webhooks allowed in any 60-minute window. A higher-level limit that prevents sustained abuse over time.',
                                        'Set to 1,000: Even if you allow 100/minute, you can\'t receive more than 1,000 total in an hour. Prevents attackers from maxing out your minute limit 60 times.'
                                    )}</h4>
                                    <p>Maximum requests allowed per hour</p>
                                </div>
                                <input type="number" class="form-input" id="cfg-requestsPerHour"
                                    value="${data.security.rateLimit.requestsPerHour}" min="1" max="100000">
                            </div>
                            <div class="config-item">
                                <div class="config-item-info">
                                    <h4>Per IP Address ${tooltip(
                                        'Individual vs. Shared Limits',
                                        'ON = Each computer (IP) gets its own limit. OFF = All computers share one limit together.',
                                        'With 100/min limit: If ON, Computer A can send 100 AND Computer B can send 100 (200 total). If OFF, Computer A and B share the 100 limit together.'
                                    )}</h4>
                                    <p>Apply limits per IP (vs. globally)</p>
                                </div>
                                <label class="toggle">
                                    <input type="checkbox" id="cfg-perIpAddress"
                                        ${data.security.rateLimit.perIpAddress ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="config-section">
                        <h3 class="config-section-title">&#128221; Logging Settings</h3>
                        <div class="config-group">
                            <div class="config-item">
                                <div class="config-item-info">
                                    <h4>File Logging ${tooltip(
                                        'Save Activity Records',
                                        'When ON, saves a detailed record of everything happening to a file on disk. Useful for troubleshooting problems later.',
                                        'Something weird happened last Tuesday? Check the logs to see exactly what webhooks arrived, any errors that occurred, and when. Without logs, you\'re flying blind.'
                                    )}</h4>
                                    <p>Write logs to disk</p>
                                </div>
                                <label class="toggle">
                                    <input type="checkbox" id="cfg-loggingEnabled"
                                        ${data.logging.enabled ? 'checked' : ''}>
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                            <div class="config-item">
                                <div class="config-item-info">
                                    <h4>Max Log File Size (MB) ${tooltip(
                                        'Log File Size Limit',
                                        'When the log file reaches this size, it\'s saved and a new one starts. Prevents logs from filling up your entire hard drive.',
                                        'Set to 100 MB: When app.log hits 100 MB, it becomes app.log.1 and a fresh app.log starts. Old logs are eventually deleted. Keeps your disk from filling up.'
                                    )}</h4>
                                    <p>Rotate logs after reaching this size</p>
                                </div>
                                <input type="number" class="form-input" id="cfg-maxLogFileSizeMB"
                                    value="${data.logging.maxFileSizeMB}" min="1" max="1000">
                            </div>
                        </div>
                    </div>

                    <div class="config-actions">
                        <span id="saveStatus" class="save-status">&#10003; Auto-save enabled</span>
                        <button type="button" class="btn btn-secondary" onclick="resetConfiguration()">
                            &#8635; Reset to Saved
                        </button>
                    </div>
                </form>
            `;

            document.getElementById('configContent').innerHTML = configHtml;
            // Setup auto-save after the form is rendered
            setupAutoSave();
        }

        let autoSaveTimeout = null;
        let lastGeneratedKey = null;

        function setupAutoSave() {
            const form = document.getElementById('configForm');
            if (!form) return;

            // Add change listeners to all inputs
            const inputs = form.querySelectorAll('input, select, textarea');
            inputs.forEach(input => {
                const eventType = (input.type === 'checkbox' || input.tagName === 'SELECT') ? 'change' : 'input';
                input.addEventListener(eventType, () => {
                    // Don't auto-save the validKeys textarea (it's for manual key entry)
                    if (input.id === 'cfg-validKeys') return;
                    triggerAutoSave();
                });
            });
        }

        function triggerAutoSave() {
            const saveStatus = document.getElementById('saveStatus');
            if (saveStatus) {
                saveStatus.className = 'save-status';
                saveStatus.innerHTML = '&#8987; Saving...';
            }

            // Debounce: wait 500ms after last change before saving
            if (autoSaveTimeout) clearTimeout(autoSaveTimeout);
            autoSaveTimeout = setTimeout(() => saveConfiguration(), 500);
        }

        async function resetConfiguration() {
            lastGeneratedKey = null;
            await loadAllData();
            showToast('Configuration reset to saved values', 'info');
        }

        async function saveConfiguration(event) {
            if (event) event.preventDefault();

            const saveStatus = document.getElementById('saveStatus');

            // Parse textarea values into arrays
            const parseLines = (text) => text.split('\\n').map(l => l.trim()).filter(l => l);

            const configUpdate = {
                webhook: {
                    maxPayloadSizeBytes: parseInt(document.getElementById('cfg-maxPayloadSizeMB').value) * 1024 * 1024,
                    enablePayloadPersistence: document.getElementById('cfg-enablePayloadPersistence').checked,
                    payloadRetentionDays: parseInt(document.getElementById('cfg-payloadRetentionDays').value),
                    alwaysReturn200: document.getElementById('cfg-alwaysReturn200').checked
                },
                security: {
                    ipAllowlist: {
                        enabled: document.getElementById('cfg-ipAllowlistEnabled').checked,
                        allowedIps: parseLines(document.getElementById('cfg-allowedIps').value),
                        allowedCidrs: parseLines(document.getElementById('cfg-allowedCidrs').value),
                        allowPrivateNetworks: document.getElementById('cfg-allowPrivateNetworks').checked
                    },
                    apiKey: {
                        enabled: document.getElementById('cfg-apiKeyEnabled').checked,
                        headerName: document.getElementById('cfg-apiKeyHeaderName').value || 'X-API-Key'
                    },
                    hmac: {
                        enabled: document.getElementById('cfg-hmacEnabled').checked,
                        headerName: document.getElementById('cfg-hmacHeaderName').value || 'X-Signature',
                        algorithm: document.getElementById('cfg-hmacAlgorithm').value
                    },
                    rateLimit: {
                        enabled: document.getElementById('cfg-rateLimitEnabled').checked,
                        requestsPerMinute: parseInt(document.getElementById('cfg-requestsPerMinute').value),
                        requestsPerHour: parseInt(document.getElementById('cfg-requestsPerHour').value),
                        perIpAddress: document.getElementById('cfg-perIpAddress').checked
                    }
                },
                logging: {
                    enabled: document.getElementById('cfg-loggingEnabled').checked,
                    maxFileSizeBytes: parseInt(document.getElementById('cfg-maxLogFileSizeMB').value) * 1024 * 1024
                }
            };

            // Add optional fields only if provided
            const validKeys = parseLines(document.getElementById('cfg-validKeys').value);
            if (validKeys.length > 0) {
                configUpdate.security.apiKey.validKeys = validKeys;
            }

            const hmacSecret = document.getElementById('cfg-hmacSharedSecret').value;
            if (hmacSecret) {
                configUpdate.security.hmac.sharedSecret = hmacSecret;
            }

            try {
                const response = await fetch('/api/dashboard/config', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(configUpdate)
                });

                const result = await response.json();

                if (response.ok && result.success) {
                    saveStatus.className = 'save-status success';
                    saveStatus.innerHTML = '&#10003; Saved';
                    // Update stats without reloading the full config (preserves generated key display)
                    const newStats = await fetchAPI('stats');
                    if (newStats) updateStats(newStats);
                } else {
                    throw new Error(result.message || result.error || 'Save failed');
                }
            } catch (error) {
                saveStatus.className = 'save-status error';
                saveStatus.innerHTML = '&#10007; ' + error.message;
            }
        }

        function updateEndpoint(data) {
            document.getElementById('webhookUrl').textContent = data.webhookUrl;
            document.getElementById('curlExample').textContent = data.exampleCurl;
        }

        async function viewWebhook(id) {
            document.getElementById('webhookModal').classList.add('active');
            document.getElementById('webhookModalContent').innerHTML = `
                <div class="empty-state">
                    <div class="spinner"></div>
                    <p>Loading webhook details...</p>
                </div>
            `;

            const data = await fetchAPI(`webhooks/${id}`);
            if (!data) {
                document.getElementById('webhookModalContent').innerHTML = `
                    <div class="empty-state">
                        <p>Failed to load webhook details</p>
                    </div>
                `;
                return;
            }

            const headersHtml = Object.entries(data.headers).map(([key, values]) => `
                <div class="header-row">
                    <span class="key">${key}</span>
                    <span class="value">${Array.isArray(values) ? values.join(', ') : values}</span>
                </div>
            `).join('');

            document.getElementById('webhookModalContent').innerHTML = `
                <div class="detail-grid">
                    <div class="detail-item">
                        <label>Request ID</label>
                        <span style="font-family: monospace; font-size: 0.9rem;">${data.id}</span>
                    </div>
                    <div class="detail-item">
                        <label>Received</label>
                        <span>${new Date(data.receivedAtUtc).toLocaleString()}</span>
                    </div>
                    <div class="detail-item">
                        <label>Method</label>
                        <span style="color: var(--accent)">${data.httpMethod}</span>
                    </div>
                    <div class="detail-item">
                        <label>Path</label>
                        <span>${data.path}</span>
                    </div>
                    <div class="detail-item">
                        <label>Source IP</label>
                        <span>${data.sourceIpAddress}:${data.sourcePort}</span>
                    </div>
                    <div class="detail-item">
                        <label>Content Size</label>
                        <span>${data.contentLengthFormatted}</span>
                    </div>
                    <div class="detail-item">
                        <label>Content Type</label>
                        <span>${data.contentType || 'N/A'}</span>
                    </div>
                    <div class="detail-item">
                        <label>Valid JSON</label>
                        <span style="color: ${data.isValidJson ? 'var(--success)' : 'var(--danger)'}">
                            ${data.isValidJson ? 'âœ“ Yes' : 'âœ— No'}
                        </span>
                    </div>
                </div>

                <h4 style="margin-bottom: 0.75rem; font-weight: 600;">Headers (${Object.keys(data.headers).length})</h4>
                <div class="headers-list" style="margin-bottom: 1.5rem;">
                    ${headersHtml}
                </div>

                <h4 style="margin-bottom: 0.75rem; font-weight: 600;">Body</h4>
                <div class="code-block">
                    <div class="code-header">
                        <span>${data.isValidJson ? 'JSON' : 'Raw'}</span>
                        <button class="copy-btn" onclick="copyToClipboard(\`${encodeURIComponent(data.rawBody)}\`, 'Body')">Copy</button>
                    </div>
                    <pre class="code-content"><code class="${data.isValidJson ? 'language-json' : ''}">${escapeHtml(data.formattedBody || data.rawBody)}</code></pre>
                </div>
            `;

            // Highlight code
            document.querySelectorAll('#webhookModalContent pre code').forEach(block => {
                hljs.highlightElement(block);
            });
        }

        function closeModal() {
            document.getElementById('webhookModal').classList.remove('active');
        }

        async function sendTestWebhook() {
            showToast('Sending test webhook...', 'info');
            const result = await fetch('/api/dashboard/test-webhook', { method: 'POST' });
            if (result.ok) {
                showToast('Test webhook sent successfully!', 'success');
                setTimeout(loadAllData, 500);
            } else {
                showToast('Failed to send test webhook', 'error');
            }
        }

        async function generateApiKey() {
            const btn = document.getElementById('btn-generate-api-key');
            const container = document.getElementById('generated-key-container');
            const keyInput = document.getElementById('generated-api-key');

            btn.disabled = true;
            btn.innerHTML = '&#9203; Generating...';

            try {
                const response = await fetch('/api/dashboard/generate-api-key', { method: 'POST' });
                const result = await response.json();

                if (result.success) {
                    // Store the key so it survives config reloads
                    lastGeneratedKey = result.apiKey;
                    keyInput.value = result.apiKey;
                    container.style.display = 'block';
                    showToast(`API key generated and added! Total keys: ${result.totalKeys}. Copy it now!`, 'success');

                    // Update the key count hint text without replacing the whole form
                    const keyCountHint = document.querySelector('#cfg-validKeys')?.closest('.config-item')?.querySelector('.config-hint');
                    if (keyCountHint) {
                        keyCountHint.textContent = `One key per line. Current keys: ${result.totalKeys}. Leave empty to keep existing keys.`;
                    }
                } else {
                    showToast(result.message || 'Failed to generate API key', 'error');
                }
            } catch (error) {
                showToast('Failed to generate API key', 'error');
                console.error('Generate API key error:', error);
            } finally {
                btn.disabled = false;
                btn.innerHTML = '&#128273; Generate API Key';
            }
        }

        function copyApiKey() {
            const keyInput = document.getElementById('generated-api-key');
            if (keyInput.value) {
                copyToClipboard(keyInput.value, 'API Key');
            }
        }

        async function refreshWebhooks() {
            const data = await fetchAPI('webhooks?limit=50');
            if (data) updateWebhooks(data.webhooks);
            const statsData = await fetchAPI('stats');
            if (statsData) updateStats(statsData);
        }

        let searchTimeout;
        async function searchWebhooks(query) {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(async () => {
                const data = await fetchAPI(`webhooks?limit=100&search=${encodeURIComponent(query)}`);
                if (data) renderWebhooks('allWebhooks', data.webhooks);
            }, 300);
        }

        function startAutoRefresh() {
            refreshInterval = setInterval(loadAllData, 30000);
        }

        function copyEndpoint() {
            const url = document.getElementById('webhookUrl').textContent;
            copyToClipboard(url, 'Endpoint URL');
        }

        function copyCurl() {
            const curl = document.getElementById('curlExample').textContent;
            copyToClipboard(curl, 'cURL command');
        }

        function copyToClipboard(text, label) {
            text = decodeURIComponent(text);
            navigator.clipboard.writeText(text).then(() => {
                showToast(`${label} copied to clipboard!`, 'success');
            }).catch(() => {
                showToast('Failed to copy', 'error');
            });
        }

        function showToast(message, type = 'info') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                <span>${type === 'success' ? 'âœ“' : type === 'error' ? 'âœ—' : 'â„¹'}</span>
                <span>${message}</span>
            `;
            container.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Close modal on escape
        document.addEventListener('keydown', e => {
            if (e.key === 'Escape') closeModal();
        });

        // Close modal on overlay click
        document.getElementById('webhookModal').addEventListener('click', e => {
            if (e.target.classList.contains('modal-overlay')) closeModal();
        });
    </script>
</body>
</html>
